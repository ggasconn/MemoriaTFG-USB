<!-- Leave a blank line before the title -->

# Resumen {.unnumbered}

El objetivo de este Trabajo de Fin de Grado ha sido construir una infraestructura hardware y software de bajo coste que permita el prototipado de dispositivos USB con diferentes características, además del desarrollo de controladores software para dichos dispositivos. Esta infraestructura está orientada a la docencia, y más concretamente a la adquisición de los conocimientos necesarios para el desarrollo de *drivers* USB.  La infraestructura permite también acercar a los estudiantes a ciertas partes del complejo protocolo USB, todo ello sin realizar una gran inversión económica, gracias al bajo coste de los dispositivos que la conforman. Asimismo, su flexibilidad ofrece un gran potencial para desarrollo de prácticas de laboratorio, permitiendo una fácil extensión y adaptación de estas a un amplio espectro de dispositivos de entrada-salida.

La parte software de la infraestructura tiene dos componentes bien diferenciados. El primero de ellos es un *firmware* desarrollado en este proyecto (basado en V-USB) que permite la implementación de dispositivos USB por software. Este *firmware* hace posible la construcción de dispositivos USB empleando un microcontrolador, y uno o varios dispositivos periféricos básicos, que pueden ser expuestos al usuario como un único dispositivo USB. Esto, unido al sistema de perfiles hardware del *firmware*, proporciona gran flexibilidad, ya que con un solo producto hardware se puede obtener una amplia funcionalidad combinando las funciones de múltiples perifericos. En segundo lugar, como parte del proyecto se ha desarrollado una colección de *drivers* de ejemplo que interactúan con diferentes periféricos haciendo uso de la API del kernel Linux. Este paquete de drivers sencillos permite a los estudiantes iniciarse en aspectos de desarrollo de controladores software para dispositivos USB en Linux.

En cuanto a la parte hardware, se han construido distintos prototipos basados en microcontroladores AVR de ATMEL. El prototipo final de la infraestructura hace uso de una placa con microcontrolador ATMega328p, y está provisto de un circuito extra que proporciona el puerto USB para la conexión a un ordenador o dispositivo móvil.  Este prototipo permite la conexión de distintos periféricos sencillos (conjuntos de LEDs RGBs, zumbadores, displays 7 segmentos, pantallas LCD, etc.), y soporta la depuración de su *firmware* USB via puerto serie, acessible mediante un segundo puerto USB. 

**palabras clave**: Firmware, USB, driver, kernel Linux, AVR, V-USB.



# Abstract {.unnumbered}

The USB communication protocol, widely used in numerous devices around the world, is complex when making changes to certain peripherals, especially when making changes to the programming of the device in question. In this project we work on the realization of a firmware for a certain chip (ATTiny85) that is capable of performing different functions on peripherals, that work with a driver loaded in Linux, all programmed in C language.

The complexity of the USB technology/specification together with the limited time that can be devoted to describing low-level input-output aspects in Computer Science degrees, makes it difficult to acquire knowledge on USB driver development, highly valued in strategic sectors. Likewise, to start developing this type of drivers it is necessary to have sufficiently simple and low-cost hardware. An example of a starter device is the Blinkstick Strip device, which has 8 colored LEDs whose state can be individually altered.

In this project, a low-cost USB device is designed and programmed that can be used massively as a test bench for the development of USB drivers. Said device will be made up of several components (LEDs, LCD screens, sensors, etc.), and will allow the developer to become familiar with different aspects and modes of interaction with USB hardware, in order to gradually face the complexity of USB. In addition to the hardware design, and the construction of a prototype of it using a microcontroller, such as the ATTiny85, it will be necessary to develop the firmware of the device as well as a set of example drivers (preferably in Linux), to expose the user to the various components of the USB device.
