<!-- Leave a blank line before the title -->

# Resumen {.unnumbered}

El objetivo de este Trabajo de Fin de Grado es construir una infraestructura hardware y software de bajo coste que permita el prototipado de dispositivos USB con diferentes características, además del desarrollo de controladores en entornos Linux para dichos dispositivos. Esta infraestructura se dedicará a la docencia, ayudando a impartir los conocimientos necesarios para el desarrollo de controladores USB y acercará a los alumnos a ciertas partes del complejo protocolo USB, todo ello sin realizar una gran inversión gracias al poco coste de los dispositivos y permitiendo evolucionar el material docente dada la flexibilidad que ofrece el proyecto.

La parte software tiene dos puntos bien diferenciados. El primero de ellos consiste en el desarrollo de un firmware que extiende un proyecto el cual permite la implementación de dispositivos USB por software. El firmware desarrollado es capaz de convertir un microcontrolador en un dispositivo USB que permite exponer al usuario numerosos periféricos conectados a un mismo dispositivo USB, haciéndolo una herramienta super flexible ya que de un solo producto hardware se pueden obtener mútiples funcionalidades ofrecidas por los perfiéricos, los cuales son fácilmente configurables gracias al sistema de plantillas que se ha diseñado. Por otro lado, se han desarrollado un conjunto de drivers de ejemplo que interactúan con los diferentes periféricos haciendo uso de las herramientas provistas por el kernel Linux para este fin. Este paquete de drivers es un ejemplo perfecto para estudiantes que quieren conocer de manera sencilla el mundo del desarrollo de controladores para dispositivos USB en Linux, ya que no son demasiado complejos y detallan con claridad el uso de las diferentes funciones y estructuras de datos necesarias para este fin.

En cuanto a la parte hardware, se ha utilizado un microcontrolador ATMega328p para crear un prototipo completamente funcional al que hemos añadido un conector micro USB que permite conectar el dipositivo a un ordenador usando simplemente un cable. Este prototipo tiene conectados diferentes periféricos que son controlados por el firmware y capaces de recibir instrucciones de los drivers desarrollados. Además, ya que se busca crear una plataforma flexible de desarrollo, se ha intergrado una placa de expansión que se encuentra actualmente en uso en la Facultad de Informática llamada *Bee*, que aporta aún más periféricos con los que interacturar y proporciona una gran capacidad de expansión al proyecto.

**palabras clave**: Firmware, USB, endpoint, kernel Linux, ReportID, AVR, V-USB, Display OLED, LEDs, Drivers.



# Abstract {.unnumbered}

The USB communication protocol, widely used in numerous devices around the world, is complex when making changes to certain peripherals, especially when making changes to the programming of the device in question. In this project we work on the realization of a firmware for a certain chip (ATTiny85) that is capable of performing different functions on peripherals, that work with a driver loaded in Linux, all programmed in C language.

The complexity of the USB technology/specification together with the limited time that can be devoted to describing low-level input-output aspects in Computer Science degrees, makes it difficult to acquire knowledge on USB driver development, highly valued in strategic sectors. Likewise, to start developing this type of drivers it is necessary to have sufficiently simple and low-cost hardware. An example of a starter device is the Blinkstick Strip device, which has 8 colored LEDs whose state can be individually altered.

In this project, a low-cost USB device is designed and programmed that can be used massively as a test bench for the development of USB drivers. Said device will be made up of several components (LEDs, LCD screens, sensors, etc.), and will allow the developer to become familiar with different aspects and modes of interaction with USB hardware, in order to gradually face the complexity of USB. In addition to the hardware design, and the construction of a prototype of it using a microcontroller, such as the ATTiny85, it will be necessary to develop the firmware of the device as well as a set of example drivers (preferably in Linux), to expose the user to the various components of the USB device.
